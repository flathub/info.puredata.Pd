app-id: info.puredata.Pd
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: pd-gui
finish-args:
# Pd-GUI/Pd-core communication; OSC, FUDI; deken
  - --share=network
# Display
  - --share=ipc
  - --socket=x11
# Audio
  - --socket=pulseaudio
  - --filesystem=xdg-run/pipewire-0
# Filesystem access
  - --filesystem=home
# Display, MIDI, webcams, controllers,...
  - --device=all
rename-icon: puredata
rename-appdata-file: org.puredata.pd-gui.metainfo.xml
rename-desktop-file: org.puredata.pd-gui.desktop
modules:
  - modules/tcl.yml
  - modules/tk.yml
  - name: pd64
    buildsystem: autotools
    config-opts:
      - --enable-jack
      - --with-floatsize=64
      - --program-transform-name='s/pd$/pd64/'
    sources:
      - type: git
        url: https://github.com/pure-data/pure-data.git
        tag: 0.55-2
        commit: 68a30a3e2672d0d57baff7d862d6b611c79d53ec
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+-[\d]+)$
          is-main-source: true
      - type: patch
        path: patches/metainfo.patch
  - name: puredata
    buildsystem: autotools
    config-opts:
      - --enable-jack
    sources:
      - type: git
        url: https://github.com/pure-data/pure-data.git
        tag: 0.55-2
        commit: 68a30a3e2672d0d57baff7d862d6b611c79d53ec
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+-[\d]+)$
          is-main-source: true
      - type: patch
        path: patches/metainfo.patch
  - name: wish
    buildsystem: simple
    build-commands:
      - test -x "${FLATPAK_DEST}/bin/wish" || IFS=:; find ${PATH} -maxdepth 1 -name "wish*.*" -print0 | sort -zVr | head -z -n1 | sed -e "s|$|${FLATPAK_DEST}/bin/wish|" | xargs -t -r0 ln -sv
